<html>
  <body>
    <script src="koinos.js"></script>
    <script>
      const serializers = {};
      window.addEventListener("message", async function (event) {
        const { command, id, args } = event.data;
        if (!args) return;
        const { serId, serArgs } = args;
        let result = 0;

        try {
          switch (command) {
            case "newSerializer":
              serializers[serId] = new Serializer(...serArgs);
              break;
            case "serialize":
              result = await serializers[serId].serialize(...serArgs);
              break;
            case "deserialize":
              result = await serializers[serId].deserialize(...serArgs);
              break;
            default:
              break;
          }
          event.source.postMessage({ id, result }, event.origin);
        } catch (error) {
          console.error(error);
          event.source.postMessage({ id, error }, event.origin);
        }
      });
    </script>
  </body>
</html>
